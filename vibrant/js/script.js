const droppable=document.querySelector(".droppable"),list=document.querySelector(".list"),ball=document.querySelector(".ball"),filledBall=document.querySelector(".filled-ball"),hand=document.querySelector(".hand"),reader=new FileReader,formatBytes=(e,t=2)=>{if(0===e)return"0 Bytes";const a=t<0?0:t,o=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,o)).toFixed(a))+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][o]};let isDragging=0;document.addEventListener("dragover",(e=>{e.preventDefault(),isDragging++,1===isDragging&&droppable.classList.add("is-dragging")})),document.addEventListener("drop",(e=>{e.preventDefault(),isDragging=0,droppable.classList.remove("is-dragging")})),list.addEventListener("dragover",(e=>{e.preventDefault()}));const dragtl=gsap.timeline({paused:!0});dragtl.to(ball,{duration:.4,translateX:"286px",autoAlpha:1,translateY:"-230px"},"drag").to(hand,{duration:.4,transformOrigin:"right",rotate:"66deg",translateY:"70px",translateX:"-20px"},"drag"),list.addEventListener("dragenter",(e=>{e.preventDefault(),droppable.classList.add("is-over"),dragtl.play()})),list.addEventListener("dragleave",(e=>{e.preventDefault(),droppable.classList.remove("is-over"),dragtl.reverse()})),list.addEventListener("drop",(e=>{e.preventDefault();let t=0;const{offsetX:a,offsetY:o}=e,{files:r}=e.dataTransfer;reader.readAsDataURL(r[0]),reader.addEventListener("load",(()=>{t++,t>1||itemMarkup(r[0],reader.result,a,o)})),droppable.classList.remove("is-over")}));const sendToClipboard=e=>{const t=document.createElement("input");t.setAttribute("value",e),t.style.display="fixed",document.body.appendChild(t),t.select();const a="Execute 'document.execCommand('copy')";try{let e=document.execCommand("copy");console.log(`${a} ${e?"successfully":"failed"}.`)}catch(e){console.log(`${a} throws exception:`,e)}document.body.removeChild(t)},extractColor=(e,t,a)=>{const o=t.querySelector("img"),r=t.querySelector(".item-colors");o.addEventListener("load",(function(){const t=new Vibrant(o,64,5).swatches();console.log(`Extracted colors from ${e.name}[id=${a}]: `,t);for(let e in t)if(t.hasOwnProperty(e)&&t[e]){const o=t[e],n=document.createElement("div");n.classList.add("item-color"),n.setAttribute("id",`${a}-${e}`),n.setAttribute("data-color",o.getHex()),n.innerHTML=`<div class="preview" style="background: ${o.getHex()}"></div>\n                <div class="code">${o.getHex().toUpperCase()}</div>\n                <div class="pop">${o.getPopulation()}</div>`,n.addEventListener("click",(e=>{const t=e.target,a=t.className;let o="undefined";"item-color"===a?o=t.getAttribute("data-color"):"code"===a?o=t.innerHTML:"preview"===a&&(o=t.style.background),sendToClipboard(o.toLowerCase())})),r.append(n)}}))},itemMarkup=(e,t,a,o)=>{const r=document.createElement("div"),n=Math.random().toString(36).substr(2,9);r.classList.add("item"),r.setAttribute("id",n),r.innerHTML=`<div class="item-img">\n            <img src="${t}" alt="img-id:${n}"/>\n        </div>\n        <div class="item-details">\n            <div class="item-name">${e.name}</div>\n            <div class="item-colors"></div>\n        </div>\n        <button class="item-delete" data-id="${n}"></button>`,list.append(r);r.querySelector(".item-delete").addEventListener("click",(e=>{e.stopPropagation(),deleteItem(e)})),extractColor(e,r,n);const l=r.querySelector(".item-img"),d=l.offsetLeft,i=l.offsetTop,s=document.createElement("div");s.classList.add("loaded-image"),s.innerHTML=`<img src="${t}" alt=""/>\n        <span>\n            <svg fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 330 330">\n                <path d="M165 7.5c-8.284 0-15 6.716-15 15v60c0 8.284 6.716 15 15 15 8.284 0 15-6.716 15-15v-60c0-8.284-6.716-15-15-15z"/>\n                <path d="M165 262.5c-8.284 0-15 6.716-15 15v30c0 8.284 6.716 15 15 15 8.284 0 15-6.716 15-15v-30c0-8.284-6.716-15-15-15z"/>\n                <path d="M315 157.5h-60c-8.284 0-15 6.716-15 15s6.716 15 15 15h60c8.284 0 15-6.716 15-15s-6.716-15-15-15z"/>\n                <path d="M90 172.5c0-8.284-6.716-15-15-15H15c-8.284 0-15 6.716-15 15s6.716 15 15 15h60c8.284 0 15-6.716 15-15z"/>\n                <path d="M281.673 55.827c-5.857-5.858-15.355-5.858-21.213 0l-42.427 42.427c-5.858 5.858-5.858 15.355 0 21.213 2.929 2.929 6.768 4.394 10.606 4.394 3.839 0 7.678-1.464 10.607-4.394l42.427-42.427c5.858-5.858 5.858-15.355 0-21.213z"/>\n                <path d="M90.753 225.533L48.328 267.96c-5.857 5.858-5.857 15.355 0 21.213 2.929 2.929 6.768 4.393 10.607 4.393 3.839 0 7.678-1.464 10.607-4.393l42.426-42.427c5.857-5.858 5.857-15.355 0-21.213-5.859-5.858-15.356-5.858-21.215 0z"/>\n                <path d="M69.541 55.827c-5.858-5.858-15.355-5.857-21.213 0-5.858 5.858-5.858 15.355 0 21.213l42.426 42.427c2.93 2.929 6.768 4.394 10.607 4.394 3.838 0 7.678-1.465 10.606-4.393 5.858-5.858 5.858-15.355 0-21.213L69.541 55.827z"/>\n            </svg>\n        </span>`,list.append(s);const c=gsap.timeline({onComplete:()=>{s.remove(),l.style.opacity=1,list.scrollTo(0,list.scrollHeight)}}),p=r.querySelectorAll("*:not(.item-img)"),u=s.querySelector("img"),g=s.querySelector("span");r.offsetLeft,r.offsetTop;c.set(droppable,{pointerEvents:"none"}).fromTo(s,{autoAlpha:1,width:20,height:20,x:a-10,y:o-10,borderRadius:"50%"},{duration:.3,width:70,height:70,x:a-30,y:o-30}).to(g,{autoAlpha:1,duration:.4},"loading").to(s,{rotation:720,duration:1.2},"loading").to(g,{autoAlpha:0,duration:.4}).to(u,{autoAlpha:1,duration:.4},"-=.1").to(s,{x:d,y:i,duration:.8,autoAlpha:1,width:200,height:160,borderRadius:4},"-=.5").set(l,{autoAlpha:1}).fromTo(p,{autoAlpha:0,y:30},{autoAlpha:1,y:0,duration:.3,stagger:.06}).to(s,{autoAlpha:0,duration:.3},"-=.2").set(droppable,{pointerEvents:"all"})},deleteItem=e=>{const t=e.target.parentNode,a=t.querySelectorAll(":scope > *");gsap.timeline({onComplete:()=>{t.remove();document.querySelector(".item")||dragtl.reverse()}}).to(a,{autoAlpha:0,y:-10,duration:.2,stagger:.1}).to(t,{height:0,paddingTop:0,paddingBottom:0,duration:.5},"-=.15")};var inputObj=document.getElementById("_ef");list.onclick=function(){list.children.length>0||inputObj.click()},inputObj.onchange=function(){let e=this.files[0];if(window.FileReader){let t=new FileReader;t.readAsDataURL(e),t.onloadend=function(t){itemMarkup(e,t.target.result,50,50)}}};